<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>aoi.js RAG API</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              50: '#f5f7ff',
              100: '#e9edff',
              500: '#6366f1',
              600: '#4f46e5',
              700: '#4338ca'
            }
          }
        }
      }
    }
  </script>
</head>
<body class="min-h-screen bg-slate-900 text-slate-200">
  <!-- Animated background -->
  <style>
    @keyframes floatSlow {
      0% { transform: translateY(0px) translateX(0px) scale(1); }
      50% { transform: translateY(-30px) translateX(20px) scale(1.05); }
      100% { transform: translateY(0px) translateX(0px) scale(1); }
    }
    @keyframes drift {
      0% { transform: translate(-10%, -10%) rotate(0deg); }
      50% { transform: translate(10%, 5%) rotate(10deg); }
      100% { transform: translate(-10%, -10%) rotate(0deg); }
    }
  </style>
  <div class="pointer-events-none fixed inset-0 -z-10 overflow-hidden">
    <div class="absolute left-[-10%] top-[-10%] h-[40rem] w-[40rem] rounded-full bg-cyan-400/10 blur-3xl animate-[drift_22s_ease-in-out_infinite]"></div>
    <div class="absolute right-[-15%] bottom-[-15%] h-[45rem] w-[45rem] rounded-full bg-sky-500/10 blur-3xl animate-[drift_28s_ease-in-out_infinite]"></div>
    <div class="absolute left-1/2 top-1/3 h-[18rem] w-[18rem] -translate-x-1/2 rounded-full bg-blue-300/10 blur-2xl animate-[floatSlow_12s_ease-in-out_infinite]"></div>
    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-slate-900/40 to-slate-900"></div>
  </div>
  <!-- Header -->
  <header class="bg-gradient-to-r from-slate-800 via-slate-800 to-slate-900 text-slate-200 border-b border-slate-800">
    <div class="mx-auto max-w-6xl px-4 py-6 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="inline-flex h-8 w-8 items-center justify-center rounded bg-cyan-500/20 text-cyan-200 font-bold">a</span>
        <h1 class="text-xl font-semibold text-slate-100">aoi.js RAG API</h1>
      </div>
      <nav class="text-sm">
        <a href="https://aoi.js.org/" target="_blank" rel="noopener" class="text-cyan-300 hover:text-cyan-200">Docs</a>
      </nav>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-8">
    <!-- Overview -->
    <section class="mb-8">
      <div class="rounded-lg border border-slate-800 bg-slate-900/80 shadow-sm">
        <div class="border-b border-slate-800 px-6 py-4">
          <h2 class="text-lg font-semibold text-slate-100">Overview</h2>
        </div>
        <div class="px-6 py-4">
          <p id="api-name" class="font-medium text-slate-100">Loading API...</p>
          <p id="api-desc" class="text-slate-400 text-sm mt-1">Fetching description</p>
        </div>
      </div>
    </section>

    <!-- Endpoints -->
    <section class="mb-8">
      <div class="rounded-lg border border-slate-800 bg-slate-900/80 shadow-sm">
        <div class="border-b border-slate-800 px-6 py-4 flex items-center justify-between">
          <h2 class="text-lg font-semibold text-slate-100">Endpoints</h2>
          <button id="refreshBtn" class="rounded bg-cyan-600 px-3 py-1.5 text-white text-sm hover:bg-cyan-700">Refresh</button>
        </div>
        <div class="px-6 py-4">
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="text-left text-slate-400">
                  <th class="py-2">Method</th>
                  <th class="py-2">Path</th>
                  <th class="py-2">Description</th>
                  <th class="py-2">Example</th>
                </tr>
              </thead>
              <tbody id="endpointsTable"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Try It -->
    <section class="grid gap-6 md:grid-cols-2">
      <!-- Query tester -->
      <div class="rounded-lg border border-slate-800 bg-slate-900/80 shadow-sm">
        <div class="border-b border-slate-800 px-6 py-4"><h3 class="font-semibold text-slate-100">Try: /api/basicQuery</h3></div>
        <div class="px-6 py-4 space-y-3">
          <label class="block text-sm font-medium text-slate-300">Request</label>
          <input id="queryRequest" type="text" placeholder="How to add a button?" class="w-full rounded border border-slate-700 bg-slate-800 text-slate-100 px-3 py-2 placeholder:text-slate-500" />
          <label class="block text-sm font-medium text-slate-300">Mode</label>
          <select id="queryMode" class="w-full rounded border border-slate-700 bg-slate-800 text-slate-100 px-3 py-2">
            <option value="">answer</option>
            <option value="code">code</option>
          </select>
          <button id="runQuery" class="rounded bg-cyan-600 px-3 py-1.5 text-white text-sm hover:bg-cyan-700">Run</button>
          <pre id="queryResult" class="mt-3 max-h-64 overflow-auto rounded bg-slate-800 text-slate-100 p-3 text-xs"></pre>
        </div>
      </div>

      <!-- Function tester -->
      <div class="rounded-lg border border-slate-800 bg-slate-900/80 shadow-sm">
        <div class="border-b border-slate-800 px-6 py-4"><h3 class="font-semibold text-slate-100">Try: /api/function</h3></div>
        <div class="px-6 py-4 space-y-3">
          <label class="block text-sm font-medium text-slate-300">Function name (without $)</label>
          <input id="funcName" type="text" placeholder="addCmdReactions" class="w-full rounded border border-slate-700 bg-slate-800 text-slate-100 px-3 py-2 placeholder:text-slate-500" />
          <button id="runFunc" class="rounded bg-cyan-600 px-3 py-1.5 text-white text-sm hover:bg-cyan-700">Run</button>
          <pre id="funcResult" class="mt-3 max-h-64 overflow-auto rounded bg-slate-800 text-slate-100 p-3 text-xs"></pre>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="mt-12 text-center text-xs text-slate-500">
      <p>© <span id="year"></span> aoi.js RAG API • Local-docs only • Tailwind CDN</p>
    </footer>
  </main>

  <script>
    const $ = (sel) => document.querySelector(sel);

    async function loadApiIndex() {
      try {
        const res = await fetch('/api');
        if (!res.ok) throw new Error('Failed to fetch /api');
        const data = await res.json();
        $('#api-name').textContent = data.name || 'aoi.js RAG API';
        $('#api-desc').textContent = data.description || 'Doc-constrained API for aoi.js help.';
        const tbody = $('#endpointsTable');
        tbody.innerHTML = '';
        (data.endpoints || []).forEach(ep => {
          const tr = document.createElement('tr');
          tr.className = 'border-t';
          tr.innerHTML = `
            <td class="py-2"><span class="inline-block rounded bg-gray-800 px-2 py-0.5 text-white text-xs">${ep.method}</span></td>
            <td class="py-2 font-mono">${ep.path}</td>
            <td class="py-2">${ep.description || ''}</td>
            <td class="py-2 font-mono text-xs"><a class="text-brand-600 hover:underline" href="${ep.example}" target="_blank" rel="noopener">${ep.example || ''}</a></td>
          `;
          tbody.appendChild(tr);
        });
      } catch (e) {
        $('#api-name').textContent = 'Failed to load API index';
        $('#api-desc').textContent = e.message;
      }
    }

    async function runQueryTester() {
      const request = $('#queryRequest').value.trim();
      const mode = $('#queryMode').value.trim();
      if (!request) {
        $('#queryResult').textContent = 'Please enter a request.';
        return;
      }
      const url = new URL('/api/basicQuery', window.location.origin);
      url.searchParams.set('request', request);
      if (mode) url.searchParams.set('mode', mode);
      try {
        const res = await fetch(url.toString());
        const json = await res.json();
        $('#queryResult').textContent = JSON.stringify(json, null, 2);
      } catch (e) {
        $('#queryResult').textContent = e.message;
      }
    }

    async function runFuncTester() {
      const name = $('#funcName').value.trim();
      if (!name) {
        $('#funcResult').textContent = 'Please enter a function name.';
        return;
      }
      const url = new URL('/api/function', window.location.origin);
      url.searchParams.set('name', name);
      try {
        const res = await fetch(url.toString());
        const json = await res.json();
        $('#funcResult').textContent = JSON.stringify(json, null, 2);
      } catch (e) {
        $('#funcResult').textContent = e.message;
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      $('#year').textContent = new Date().getFullYear();
      loadApiIndex();
      $('#refreshBtn').addEventListener('click', loadApiIndex);
      $('#runQuery').addEventListener('click', runQueryTester);
      $('#runFunc').addEventListener('click', runFuncTester);
    });
  </script>
</body>
</html>
